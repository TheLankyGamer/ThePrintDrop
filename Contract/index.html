<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Print Drop Rental Agreement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        /* Style for inputs to look like a form field in a document */
        .doc-input {
            border: none;
            border-bottom: 1px solid #000;
            padding: 2px 4px;
            background-color: transparent;
            min-width: 100px;
            outline: none;
            font-weight: 500;
        }
        .doc-input:focus {
            border-bottom: 2px solid #3b82f6; /* Blue border on focus */
        }
        .section-header {
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 4px;
        }
        /* Print styles */
        @media print {
            body { background-color: white; }
            .print-hidden { display: none; }
            .doc-input { border-bottom: 1px dashed #444; }
            .agreement-container {
                box-shadow: none !important;
                border: none !important;
            }
        }
        /* Button layout: place the submit button after the agreement to avoid overlap */
        .agreement-container{ position: relative; padding-bottom: 32px; }
        .submit-wrapper{ text-align: right; margin-top: 48px; }
        .submit-wrapper .submit-btn{ display:inline-block; }

        /* Expand/fullscreen button inside the agreement (top-right) */
        .expand-btn{
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 40;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .expand-btn:focus{ outline: 3px solid rgba(31,111,235,0.12); }

        /* Responsive: reduce spacing on narrow screens */
        @media (max-width:520px){
            .submit-wrapper{ margin-top: 28px; }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="agreement-container max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl border border-gray-100">

        <h1 class="text-3xl md:text-4xl font-bold text-center mb-6 text-gray-800">The Print Drop Rental Agreement</h1>
        <p class="text-center text-sm mb-8 text-gray-600 print-hidden">Fill in the fields below. Use the browser's print function to save/print the completed document.</p>
        <!-- Expand/fullscreen control inside the agreement -->
        <button id="expand-contract" class="expand-btn print-hidden" aria-pressed="false" aria-label="Expand contract to fullscreen">Expand</button>
        <!-- Button removed from the top; it will be placed inside the agreement container at the bottom-right -->

        <!-- Preamble -->
        <p class="mb-4">
            This Rental Agreement is made and entered into on 
            <input type="date" class="doc-input w-40 text-sm" value="" placeholder="Date">, by and between:
        </p>

        <!-- Owner Details -->
        <div class="mb-6 border p-4 rounded-lg bg-gray-50">
            <h2 class="text-lg font-semibold mb-3">Owner Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex items-center">
                    <label class="font-medium mr-2 whitespace-nowrap">Owner:</label>
                    <input type="text" class="doc-input w-full" placeholder="Your Full Name / The Print Drop">
                </div>
                <div class="flex items-center">
                    <label class="font-medium mr-2 whitespace-nowrap">Email:</label>
                    <input type="email" class="doc-input w-full" placeholder="Your Email">
                </div>

                <div class="flex items-center">
                    <label class="font-medium mr-2 whitespace-nowrap">Phone:</label>
                    <input type="tel" class="doc-input w-full" placeholder="Your Phone Number">
                </div>
            </div>
        </div>

        <!-- Renter Details -->
        <div class="mb-8 border p-4 rounded-lg bg-indigo-50">
            <h2 class="text-lg font-semibold mb-3">Renter Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex items-center">
                    <label class="font-medium mr-2 whitespace-nowrap">Renter:</label>
                    <input type="text" class="doc-input w-full" placeholder="Renter’s Full Name / Company Name">
                </div>
                <div class="flex items-center">
                    <label class="font-medium mr-2 whitespace-nowrap">Email:</label>
                    <input type="email" class="doc-input w-full" placeholder="Renter’s Email">
                </div>
                <div class="md:col-span-2 flex items-center">
                    <label class="font-medium mr-2 whitespace-nowrap">Address:</label>
                    <input type="text" class="doc-input w-full" placeholder="Renter’s Address">
                </div>
                <div class="flex items-center">
                    <label class="font-medium mr-2 whitespace-nowrap">Phone:</label>
                    <input type="tel" class="doc-input w-full" placeholder="Renter’s Phone Number">
                </div>
            </div>
        </div>

        <!-- Contract Sections -->

        <!-- 1. Equipment Description -->
        <div class="mb-4">
            <p class="section-header">1. Equipment Description</p>
            <p class="pl-4">The Owner agrees to rent to the Renter the following equipment:</p>
            <ul class="list-disc list-inside pl-8">
                <li>Mini Art Print Vending Machine</li>
                <li>Model/Description: Vending Machine & Side table</li>
                <li>Included items: 
                    <input type="text" class="doc-input w-80 text-sm" placeholder="Quarters, mini art prints and envelopes">
                </li>
            </ul>
        </div>

        <!-- 2. Rental Term -->
        <div class="mb-4">
            <p class="section-header">2. Rental Term</p>
            <p class="pl-4">Start Date: 
                <input type="text" class="doc-input w-64 text-sm" placeholder="Date & Time of Delivery/Setup">
            </p>
            <p class="pl-4">End Date: 
                <input type="text" class="doc-input w-64 text-sm" placeholder="Date & Time of Pickup/Return">
            </p>
            <p class="pl-4 text-sm mt-1">The rental period includes setup, event operation, and breakdown. Any extension beyond the agreed period must be approved in writing by the Owner and may incur additional fees.</p>
        </div>

        <!-- 3. Rental Fees and Payment -->
        <div class="mb-4">
            <p class="section-header">3. Rental Fees and Payment</p>
            <p class="pl-4">Rental Fee: $
                <input type="number" class="doc-input w-24 text-sm" placeholder="Amount"> per event or $
                <input type="number" class="doc-input w-24 text-sm" placeholder="Amount"> per day.
            </p>
            <!-- UPDATED: Deposit is now a fillable field and blank by default -->
            <p class="pl-4">Deposit: $
                <input type="number" class="doc-input w-24 text-sm" placeholder="Amount"> (holds date)
            </p>
            <p class="pl-4 font-semibold mt-2">Payment Terms:</p>
            <ul class="list-disc list-inside pl-8">
                <li>50% due upon signing; 50% due before or on event date</li>
                <li>Payments may be made via Venmo or Zelle</li>
            </ul>
        </div>

        <!-- 4. Delivery, Setup, and Pickup -->
        <div class="mb-4">
            <p class="section-header">4. Delivery, Setup, and Pickup</p>
            <p class="pl-4">Owner (or representative) will handle delivery and setup at the event location:</p>
            <p class="pl-4 font-semibold mt-1">Event Venue: 
                <input type="text" class="doc-input w-full text-sm" placeholder="Venue Name & Address">
            </p>
            <p class="pl-4 text-sm mt-1">Renter agrees to provide reasonable access for delivery, installation, and removal. If self-pickup is allowed, Renter assumes full responsibility from the time the machine leaves the Owner’s possession.</p>
        </div>

        <!-- 5. Use of Equipment -->
        <div class="mb-4">
            <p class="section-header">5. Use of Equipment</p>
            <p class="pl-4">The vending machine may only be used for the agreed purpose and at the specified event. Renter shall not move, modify, or tamper with the machine without Owner’s consent.</p>
            <p class="pl-4 font-semibold">Revenue Arrangement: 
                <input type="text" class="doc-input w-full text-sm" placeholder="e.g., Owner retains 100% of vending revenue">
            </p>
        </div>

        <!-- 6. Damage, Loss, or Theft -->
        <div class="mb-4">
            <p class="section-header">6. Damage, Loss, or Theft</p>
            <p class="pl-4">Renter is responsible for any loss, theft, or damage (excluding normal wear and tear) during the rental period. The cost of repairs or replacement will be deducted from the security deposit or billed to the Renter. The Renter agrees to notify the Owner immediately of any malfunction or incident.</p>
        </div>

        <!-- 7. Liability and Insurance -->
        <div class="mb-4">
            <p class="section-header">7. Liability and Insurance</p>
            <p class="pl-4">Owner shall not be liable for any injury, damage, or loss arising from the Renter’s use or misuse of the equipment. Renter assumes full responsibility for the safe operation of the equipment during the event.</p>
        </div>

        <!-- 8. Cancellation Policy -->
        <div class="mb-4">
            <p class="section-header">8. Cancellation Policy</p>
            <p class="pl-4">Cancellations made more than 
                <input type="number" class="doc-input w-12 text-sm" placeholder="X"> days before the event: full refund (minus processing fees).
            </p>
            <p class="pl-4">Cancellations made within 
                <input type="number" class="doc-input w-12 text-sm" placeholder="X"> days of the event: forfeiture of deposit.
            </p>
            <p class="pl-4 text-sm mt-1">If the Owner must cancel due to unforeseen circumstances, all payments will be refunded in full.</p>
        </div>

        <!-- 9. Ownership -->
        <div class="mb-4">
            <p class="section-header">9. Ownership</p>
            <p class="pl-4">The vending machine and all associated materials remain the sole property of the Owner at all times.</p>
        </div>

        <!-- 10. Governing Law -->
        <div class="mb-4">
            <p class="section-header">10. Governing Law</p>
            <p class="pl-4">This Agreement shall be governed by and interpreted in accordance with the laws of the State/Province of 
                <input type="text" class="doc-input w-64 text-sm" placeholder="Your Location (State/Province)">.
            </p>
        </div>

        <!-- 11. Entire Agreement -->
        <div class="mb-8">
            <p class="section-header">11. Entire Agreement</p>
            <p class="pl-4">This document constitutes the entire agreement between the Parties and supersedes any prior discussions or understandings.</p>
        </div>

        <!-- Signatures -->
        <h2 class="text-xl font-bold mb-6 border-t pt-4">Signatures</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Owner Signature -->
            <div>
                <div class="h-10 border-b border-black mb-1"></div>
                <p class="text-sm">Owner Signature</p>
                <input type="text" class="doc-input w-full mt-4" placeholder="Owner Name (Print)">
                <p class="text-sm">Name</p>
                <input type="date" class="doc-input w-full mt-4" placeholder="Date">
                <p class="text-sm">Date</p>
            </div>
            <!-- Renter Signature -->
            <div>
                <div class="h-10 border-b border-black mb-1"></div>
                <p class="text-sm">Renter Signature</p>
                <input type="text" class="doc-input w-full mt-4" placeholder="Renter Name (Print)">
                <p class="text-sm">Name</p>
                <input type="date" class="doc-input w-full mt-4" placeholder="Date">
                <p class="text-sm">Date</p>
            </div>
        </div>

        <!-- Submit button moved outside the agreement to avoid overlap -->
    </div>

    <div class="submit-wrapper print-hidden">
        <button id="submit-contract" class="submit-btn bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Submit</button>
    </div>

    </div>

    <script>
        // Submit the filled contract via EmailJS (client-side) or fallback to PDF download.
        (function(){
            // Configuration: fill these values with your EmailJS credentials and template details.
            // To use EmailJS, create an account at https://www.emailjs.com/, create a service and template,
            // then copy your `service_id`, `template_id`, and `user_id` here. The template should accept a
            // `contract_html` parameter which will contain the filled contract HTML.
            const EMAIL_CONFIG = {
                userId: '', // e.g. 'user_XXXXXXXXX'
                serviceId: '', // e.g. 'service_xxx'
                templateId: '', // e.g. 'template_xxx'
                to_email: '' // optional: recipient email (can also be set in template)
            };

            function replaceInputs(root){
                const inputs = root.querySelectorAll('input, textarea, select');
                inputs.forEach(inp => {
                    const span = document.createElement('span');
                    let value = '';
                    if (inp.type === 'date' || inp.type === 'text' || inp.type === 'email' || inp.type === 'tel' || inp.type === 'number'){
                        value = inp.value || inp.placeholder || '';
                    } else {
                        value = inp.value || '';
                    }
                    span.textContent = value;
                    if (inp.classList.contains('doc-input')){
                        span.style.borderBottom = '1px solid #000';
                        span.style.padding = '2px 4px';
                        span.style.display = 'inline-block';
                        if (!value) span.innerHTML = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    }
                    inp.parentNode.replaceChild(span, inp);
                });
            }

            function getInlineStyle(){
                const styleTag = document.querySelector('head style');
                return styleTag ? styleTag.innerHTML : '';
            }

            function buildDocumentHTML(innerHTML){
                const styles = getInlineStyle();
                const title = document.title || 'Contract';
                return `<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${title}</title><style>${styles}</style></head><body>${innerHTML}</body></html>`;
            }

            function sendEmail(contractHTML){
                if (!EMAIL_CONFIG.serviceId || !EMAIL_CONFIG.templateId || !EMAIL_CONFIG.userId){
                    return Promise.reject(new Error('EmailJS not configured.')); 
                }
                const payload = {
                    service_id: EMAIL_CONFIG.serviceId,
                    template_id: EMAIL_CONFIG.templateId,
                    user_id: EMAIL_CONFIG.userId,
                    template_params: {
                        contract_html: contractHTML,
                        to_email: EMAIL_CONFIG.to_email || ''
                    }
                };
                return fetch('https://api.emailjs.com/api/v1.0/email/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }).then(res => {
                    if (!res.ok) throw new Error('EmailJS request failed');
                    return res.json();
                });
            }

            function generatePDFandDownload(clone){
                return new Promise((resolve, reject) => {
                    // Place clone off-screen so html2pdf can measure it
                    const wrapper = document.createElement('div');
                    wrapper.style.position = 'fixed';
                    wrapper.style.left = '-9999px';
                    wrapper.style.top = '0';
                    wrapper.appendChild(clone);
                    document.body.appendChild(wrapper);

                    const opt = {
                        margin:       0.5,
                        filename:     'rental-agreement.pdf',
                        image:        { type: 'jpeg', quality: 0.98 },
                        html2canvas:  { scale: 2, useCORS: true },
                        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
                    };

                    // Use save() which triggers download directly. Resolve when finished.
                    html2pdf().set(opt).from(clone).save().then(() => {
                        wrapper.remove();
                        resolve();
                    }).catch(err => {
                        wrapper.remove();
                        reject(err);
                    });
                });
            }

            function submitContract(){
                const container = document.querySelector('.agreement-container');
                if (!container) return alert('Agreement container not found');
                const clone = container.cloneNode(true);
                replaceInputs(clone);

                // remove the submit button in clone if present
                const b = clone.querySelector('#submit-contract'); if (b) b.remove();

                const standaloneHTML = buildDocumentHTML(clone.outerHTML);

                // Try to send via EmailJS if configured
                if (EMAIL_CONFIG.serviceId && EMAIL_CONFIG.templateId && EMAIL_CONFIG.userId){
                    sendEmail(standaloneHTML).then(() => {
                        alert('Contract sent by email.');
                    }).catch(err => {
                        console.error(err);
                        alert('Email send failed — falling back to PDF download.');
                        // fallback to PDF download
                        generatePDFandDownload(clone).catch(e => { console.error(e); alert('PDF generation failed.'); });
                    });
                } else {
                    // No email config: fallback to PDF download
                    generatePDFandDownload(clone).catch(e => { console.error(e); alert('PDF generation failed.'); });
                }
            }

            // Hook up button
            const submitBtn = document.getElementById('submit-contract');
            if (submitBtn){
                submitBtn.addEventListener('click', function(){
                    submitContract();
                });
            }

            // Listen for messages from parent to trigger submission or fullscreen
            window.addEventListener('message', function(ev){
                try{
                    const data = typeof ev.data === 'string' ? JSON.parse(ev.data) : ev.data;
                    if (data && (data.type === 'generate-pdf' || data.type === 'submit-contract')){
                        submitContract();
                    }
                    if (data && data.type === 'toggle-fullscreen'){
                        toggleFullscreen();
                    }
                }catch(e){
                    if (ev.data && (ev.data.type === 'generate-pdf' || ev.data.type === 'submit-contract')) submitContract();
                    if (ev.data && ev.data.type === 'toggle-fullscreen') toggleFullscreen();
                }
            }, false);

            // Fullscreen / expand control
            const expandBtn = document.getElementById('expand-contract');
            function isFullscreen(){ return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement; }
            function updateExpandLabel(){
                const pressed = !!isFullscreen();
                if (expandBtn){
                    expandBtn.textContent = pressed ? 'Exit' : 'Expand';
                    expandBtn.setAttribute('aria-pressed', pressed ? 'true' : 'false');
                    expandBtn.setAttribute('aria-label', pressed ? 'Exit fullscreen' : 'Expand contract to fullscreen');
                }
            }
            function toggleFullscreen(){
                const el = document.documentElement;
                if (!isFullscreen()){
                    const req = el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen;
                    if (req) req.call(el);
                } else {
                    const exit = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
                    if (exit) exit.call(document);
                }
            }
            if (expandBtn){
                expandBtn.addEventListener('click', function(){ toggleFullscreen(); });
            }
            document.addEventListener('fullscreenchange', updateExpandLabel);
            document.addEventListener('webkitfullscreenchange', updateExpandLabel);
            document.addEventListener('mozfullscreenchange', updateExpandLabel);
            document.addEventListener('MSFullscreenChange', updateExpandLabel);
        })();
    </script>

</body>
</html>